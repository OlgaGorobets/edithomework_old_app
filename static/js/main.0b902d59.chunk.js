(this.webpackJsonpmy_editor=this.webpackJsonpmy_editor||[]).push([[0],{113:function(e,t,a){},114:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(23),l=a(11),s=a(42),c=a(25),u=a(6),d=a(4),o=a(26),m=a.n(o),g=a(56),p=a.n(g),f="CHANGE_ACTIVE_PDF",b="CHANGE_TEXT_VALUE",v="REMOVE_TEXT_VALUE",E="ADD_NEW_TEXT_VALUE",_="REMOVE_MESSAGE",h="ADD_NEW_MESSAGE",O="ADD_FIRST_MESSAGE",x="REMOVE_PAGE",j="ADD_NEW_PAGE",y="SIGN_FORM",w="SIGN_FB",k="SIGN_OUT_FORM",N="SIGN_FORM_AND_ADD_NEW_PAGE",F="ADD_PDF",I="REMOVE_PDF",T="CHANGE_PDF_DATE",C="CHANGE_PAGE_DATE",S="CHANGE_PAGE_NAME",D="LOAD_USERS",P="LOAD_PAGES",A="LOAD_PDFS",B="LOAD_TEXTS",R="LOAD_MESSAGES",L="LOAD_CURRENT_USER";function U(e){return{type:b,id:e.id,text:e.text,max_width:e.max_width,x:e.x,y:e.y,status:e.status}}function G(e){return{type:x,id:e}}function M(e){return{type:y,name:e.login,pass:p.a.hex_md5(e.pass)}}function z(e){return{type:w,name:e.name,pass:e.pass,photo:e.photo,id:e.id}}function H(e){return{type:F,path:e.path,images:e.images,user_id:e.user_id}}function V(e){return{type:T,id:e}}function J(e){return{type:C,id:e}}function W(e){return{type:D,data:e}}function Y(e){return{type:P,data:e}}function X(e){return{type:B,data:e}}function q(e){return{type:A,data:e}}function K(e){return{type:R,data:e}}function Q(e){return{type:L,id:e}}function Z(e,t){return!!(e.className&&e.className.split&&e.className.split(" ").indexOf(t)>=0)||e.parentNode&&Z(e.parentNode,t)}function $(e){var t=e?new Date(e):new Date,a=""+["Jan","Feb","March","Apr","May","June","July","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],n=""+t.getDate(),i=t.getFullYear(),r=t.getHours(),l=t.getMinutes();return a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),n+" "+a+","+i+" "+r+":"+l}var ee={current_user:{id:null},users:[],pdfs:[],texts:[],messages:[],active_pdf_index:0,pages:[]};var te=a(44),ae=a(30),ne=a(47),ie=a(20),re=a(33),le=a(13),se=a(10),ce=a(8),ue=a(43),de=a(9),oe=a(12),me=a(21),ge=a(50),pe=a(35),fe=a(40),be=a(71),ve=a.n(be),Ee=function(e){var t={login:"",pass:"",name:""},a={login:!1,pass:!1,name:!1},r={name:e.addPage,login:e.signIn,pass:e.signIn},l=Object(n.useState)(!1),s=Object(de.a)(l,2),c=s[0],u=s[1],o=Object(n.useState)(!1),m=Object(de.a)(o,2),g=(m[0],m[1],Object(n.useState)(Object(d.a)({},t))),p=Object(de.a)(g,2),f=p[0],b=p[1],v=Object(n.useState)(Object(d.a)({},a)),E=Object(de.a)(v,2),_=E[0],h=E[1],O=function(){return u(!1)},x=function(){b(Object(d.a)({},t))},j=function(e){b(Object(d.a)({},f,Object(ue.a)({},e.target.getAttribute("name"),e.target.value))),h(Object(d.a)({},a))},y="",w="",k="",N="",F="";return e.signIn&&(y=i.a.createElement(fe.a,null,i.a.createElement(fe.a.Body,null,i.a.createElement(fe.a.Title,null,"Login or Register ",i.a.createElement("small",null,"(if you don't have an account)")),i.a.createElement(fe.a.Text,null,i.a.createElement("div",null,i.a.createElement(ge.a.Control,{size:"sm",name:"login",type:"text",value:f.login,placeholder:"Login",onChange:j}),_.login?i.a.createElement(pe.a,{variant:"danger"},"Required field"):i.a.createElement(i.a.Fragment,null)),i.a.createElement("div",null,i.a.createElement(ge.a.Control,{size:"sm",name:"pass",type:"password",value:f.pass,placeholder:"Password",onChange:j}),_.pass?i.a.createElement(pe.a,{variant:"danger"},"Required field"):i.a.createElement(i.a.Fragment,null))))),N=i.a.createElement(ve.a,{appId:"176592233585640",autoLoad:!1,fields:"name,email,picture",callback:function(t){t&&"function"===typeof e.fb&&e.fb(t),O(),x()},version:"3.1",cssClass:"my-facebook-button-class",icon:"fa-facebook"})),e.sureRemove&&(w=i.a.createElement("div",null,"Are you sure? You won't be able to recover this page! ")),e.sureRemovePdf&&(k=i.a.createElement("div",null,"Are you sure? You won't be able to recover this Pdf and all pages created from this Pdf will be removed! ")),e.addPage&&(F=i.a.createElement("div",null,i.a.createElement(ge.a.Control,{size:"sm",type:"text",name:"name",value:f.name,placeholder:"Name",onChange:j}),_.name?i.a.createElement(pe.a,{variant:"danger"},"Required field"):i.a.createElement(i.a.Fragment,null))),i.a.createElement(i.a.Fragment,null,i.a.createElement(oe.a,{size:e.button.large?"lg":"sm",variant:"primary",onClick:function(){return u(!0)}},e.button.icon?i.a.createElement(se.a,{icon:e.button.icon}):"",e.button.title),i.a.createElement(me.a,{show:c,onHide:O,animation:!1},i.a.createElement(me.a.Header,{closeButton:!0},i.a.createElement(me.a.Title,null,e.title)),i.a.createElement(me.a.Body,null,y,N,"",w,k,F),i.a.createElement(me.a.Footer,null,e.buttons.map((function(e,t){return i.a.createElement(oe.a,{size:"sm",key:t,variant:"primary",onClick:function(){(function(){var e=!0,t={};for(var a in r)if(r[a]){var n=0==f[a].trim().length;t[a]=n,n&&(e=!1)}else t[a]=!1;return h(Object(d.a)({},t)),e})()&&("function"===typeof e.func&&e.func(f),O(),x())}},e.title)})))))},_e=a(29),he=function(e){var t=e.pdf,a=e.dispatch,n={signIn:!1,signUp:!1,sureRemovePdf:!0,title:"Remove PDF File",button:{title:"Remove PDF",icon:ce.k},buttons:[{title:"Cancel"},{title:"Remove it!",func:function(){var e;a((e=t.id,{type:I,id:e}))}}]};return i.a.createElement(le.a.Item,{className:t.is_active?"list-group-item-primary":""},i.a.createElement("div",{className:"itemTitle"},i.a.createElement(oe.a,{variant:"link",onClick:function(e){var n;e.preventDefault(),a((n=t.index,{type:f,index:n}))}},i.a.createElement("span",null,t.path," ",i.a.createElement(se.a,{icon:ce.e})))),i.a.createElement("div",{className:"absBtns"},null!==t.current_user.id&&t.user&&t.current_user.id==t.user.id?i.a.createElement(_e.a,null,i.a.createElement(Ee,n)):i.a.createElement(i.a.Fragment,null)),i.a.createElement("div",{className:"calendarBlock"},i.a.createElement("div",{className:"calendarIcon"},i.a.createElement(se.a,{icon:ce.a})),i.a.createElement("div",{className:"calendarValue"},t.user?i.a.createElement("div",null,i.a.createElement("small",null,"Loaded by ",t.user.id==t.current_user.id?"you":t.user.name," ",t.load_date),i.a.createElement("div",null,i.a.createElement("small",null,"Last pages edits - ",t.last_edit_date))):i.a.createElement(i.a.Fragment,null))))},Oe=he=Object(l.b)()(he),xe=a(73),je=Object(l.b)((function(e){return{current_user:e.current_user}}))((function(e){var t=e.current_user,a=e.dispatch,r=Object(n.useState)(null),l=Object(de.a)(r,2),s=l[0],c=l[1],u=Object(n.useState)(null),m=Object(de.a)(u,2),g=m[0],p=m[1],f=Object(n.useState)({show:!1,title:"",text:""}),b=Object(de.a)(f,2),v=b[0],E=b[1],_=function(e){var t=new FormData;t.append("file",e);return Object(o.post)("/upload.php",t,{headers:{"content-type":"multipart/form-data"}})};return i.a.createElement(i.a.Fragment,null,i.a.createElement("form",{onSubmit:function(e){e.preventDefault(),s&&p(!0),_(s).then((function(e){p(!1);var n=e.data;0==n.error&&a(H({path:n.file,images:JSON.parse(n.images),user_id:t.id}))}))}},i.a.createElement("h6",null,"Upload PDF File"),g?i.a.createElement("span",null,i.a.createElement(xe.a,{animation:"border",variant:"secondary"}),"Wait please, File is Loading..."):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"custom-file"},i.a.createElement("input",{type:"file",className:"custom-file-input",id:"inputGroupFile01","aria-describedby":"inputGroupFileAddon01",onChange:function(e){c(e.target.files[0]),e.target.files[0]&&(p(!0),_(e.target.files[0]).then((function(e){p(!1);var n=e.data;0==n.error?a(H({path:n.file,images:JSON.parse(n.images),user_id:t.id})):E(Object(d.a)({},v,{show:!0,title:"File Upload Error",text:"File wasn't loaded. "+n.error}))})).catch((function(e){p(!1),E(Object(d.a)({},v,{show:!0,title:"File Upload Error",text:"File wasn't loaded. Somthing went wrong..."}))})))},size:"sm"}),i.a.createElement("label",{className:"custom-file-label",size:"sm",htmlFor:"inputGroupFile01"},"Choose file"),i.a.createElement("button",{type:"submit",style:{display:"none"}},"Upload")))),i.a.createElement(me.a,{show:v.show,onHide:function(){E(Object(d.a)({},v,{show:!1}))}},i.a.createElement(me.a.Header,{closeButton:!0},i.a.createElement(me.a.Title,null,v.title)),i.a.createElement(me.a.Body,null,v.text),i.a.createElement(me.a.Footer,null,i.a.createElement(oe.a,{variant:"primary",onClick:function(){E(Object(d.a)({},v,{show:!1}))}},"Ok"))))})),ye=Object(l.b)((function(e){return{pdfs:e.pdfs,active_pdf_index:e.active_pdf_index,users:e.users,current_user:e.current_user}}))((function(e){var t=e.pdfs,a=e.active_pdf_index,n=e.users,r=e.current_user,l=e.dispatch,s={signIn:!0,signUp:!1,fb:function(e){console.log("response",e.id),e.id&&l(z({id:e.id,name:e.name,pass:e.accessToken,photo:e.picture.data.url}))},title:"Login or Register to Upload File",button:{title:"Login or Register to Upload PDF File",icon:ce.j,large:!0},buttons:[{title:"Cancel"},{title:"Ok",func:function(e){l(M(e))}}]};return i.a.createElement(le.a,{className:"list-group-flush"},i.a.createElement(le.a.Item,{className:"topItem"},null==r.id?i.a.createElement(Ee,s):i.a.createElement(je,null)),i.a.createElement("div",{className:"scrollBlock"},t.sort((function(e,t){var a=new Date(e.last_edit_date),n=new Date(t.last_edit_date);return+a>+n?-1:+a<+n?1:0})).map((function(e,t){var l=n.filter((function(t){return t.id==e.user_id})),s=l.length>0?l[0]:null,c=Object(d.a)({},e,{is_active:t===a,index:t,user:s,current_user:r});return i.a.createElement(Oe,Object.assign({key:t},{pdf:c}))})),0==t.length?i.a.createElement(le.a.Item,null,"Don't have any PDF Files"):i.a.createElement(i.a.Fragment,null)))})),we=function(e){var t=e.page,a=e.dispatch,n={signIn:!1,signUp:!1,sureRemove:!0,title:"Remove Book",button:{title:"Remove Book",icon:ce.k},buttons:[{title:"Cancel"},{title:"Remove it!",func:function(){a(V(t.pdf_id)),a(G(t.id))}}]};return i.a.createElement(le.a.Item,null,i.a.createElement("div",{className:"itemTitle"},i.a.createElement(c.b,{to:"/pages/"+t.id},i.a.createElement("span",null,t.name)," ",i.a.createElement(se.a,{icon:ce.e}))),i.a.createElement("div",{className:"absBtns"},t.user&&t.user.id==t.current_user.id?i.a.createElement(_e.a,null,i.a.createElement(Ee,n)):i.a.createElement(i.a.Fragment,null)),i.a.createElement("div",{className:"calendarBlock"},i.a.createElement("div",{className:"calendarIcon"},i.a.createElement(se.a,{icon:ce.a})),i.a.createElement("div",{className:"calendarValue"},t.user?i.a.createElement("div",null,i.a.createElement("small",null,"Added by ",t.user.id==t.current_user.id?"you":t.user.name," ",t.load_date),i.a.createElement("div",null,i.a.createElement("small",null,"Last edit - ",t.last_edit_date))):i.a.createElement(i.a.Fragment,null))))},ke=we=Object(l.b)()(we),Ne=Object(l.b)((function(e){return{pages:e.pages,pdfs:e.pdfs,active_pdf_index:e.active_pdf_index,users:e.users,current_user:e.current_user}}))((function(e){var t=e.pages,a=e.pdfs,n=e.active_pdf_index,r=e.users,l=e.current_user,s=e.dispatch,c=a.length>0?a[n].id:null,u=a.length>0?a[n].path:null,o=t.filter((function(e){return c==e.pdf_id})),m={signIn:!1,signUp:!1,addPage:!0,title:"Create New Book",button:{title:"Create New Book",icon:ce.j,large:!0},buttons:[{title:"Cancel"},{title:"Create New Book",func:function(e){var t;s(V(c)),s((t={name:e.name,pdf_id:c,user_id:l.id},{type:j,name:t.name,pdf_id:t.pdf_id,user_id:t.user_id}))}}]},g={signIn:!0,signUp:!0,addPage:!1,fb:function(e){console.log("response",e.id),e.id&&s(z({id:e.id,name:e.name,pass:e.accessToken,photo:e.picture.data.url}))},title:"Login or Register to Create New Book",button:{title:"Login or Register to Create New Book",icon:ce.j,large:!0},buttons:[{title:"Cancel"},{title:"Ok",func:function(e){s(M({login:e.login,pass:e.pass}))}}]};return i.a.createElement(i.a.Fragment,null,a.length>0?i.a.createElement(le.a,{className:"list-group-flush"},i.a.createElement(le.a.Item,{className:"topItem"},null!==l.id?i.a.createElement(Ee,m):i.a.createElement(Ee,g),o.length>0&&null!==u?i.a.createElement("div",{className:"topItemText"},"Books, created from  ",u,": "):i.a.createElement(i.a.Fragment,null)),i.a.createElement("div",{className:"scrollBlock"},o.sort((function(e,t){var a=new Date(e.last_edit_date),n=new Date(t.last_edit_date);return+a>+n?-1:+a<+n?1:0})).map((function(e,t){var a=r.filter((function(t){return t.id==e.user_id})),n=a.length>0?a[0]:null,s=Object(d.a)({},e,{user:n,current_user:l});return i.a.createElement(ke,Object.assign({key:t},{page:s}))})),0==o.length?i.a.createElement(le.a.Item,null,"Don't have any Books"):i.a.createElement(i.a.Fragment,null))):i.a.createElement(i.a.Fragment,null))})),Fe=Object(l.b)((function(e){return{pdfs:e.pdfs,active_pdf_index:e.active_pdf_index}}))((function(e){e.pdfs,e.active_pdf_index;return i.a.createElement(i.a.Fragment,null,i.a.createElement(re.a,null,i.a.createElement(ie.a,null,i.a.createElement("div",{className:"blockBorder"},i.a.createElement(ye,null)))),i.a.createElement(re.a,null,i.a.createElement(ie.a,null,i.a.createElement("div",{className:"blockBorder"},i.a.createElement(Ne,null)))))})),Ie=(a(109),function(e){var t=e.images,a=e.activeIndex,r=e.items,l=e.onPageChange,s=(e.pageId,Object(n.useState)(0)),c=Object(de.a)(s,2),u=c[0],d=c[1],o=Object(n.useState)(0),m=Object(de.a)(o,2),g=m[0],p=m[1],f=Object(n.useState)(t),b=Object(de.a)(f,2),v=b[0],E=b[1],_=function(e,a){e.preventDefault();var n=parseInt(t.length/r),i="next"==a?u<n?u+1:0:0==u?n:u-1;if(d(i),!(g>=r*i&&g<r*i+r)){var s=r*i;p(s),window.location.hash="#page_"+s,"function"==typeof l&&l({selected:s})}E(t.filter((function(e,t){return t>=r*i&&t<r*i+r})))};return Object(n.useEffect)((function(){var e=u;console.log(a,"activeIndex"),a>0&&(p(a),a>r*u+r&&(e=parseInt(a/r),d(e))),E(t.filter((function(t,a){return a>=r*e&&a<r*e+r}))),console.log("--pag->>>")}),[t]),i.a.createElement("div",{className:"imagePreviewsContainer"},t.length<r?i.a.createElement(i.a.Fragment,null):i.a.createElement("div",{className:"imagePreviewsPrev",onClick:function(e){_(e,"prev")}},i.a.createElement(se.a,{icon:ce.f})),i.a.createElement("div",{className:"imagePreviews"},v.map((function(e,t){var a=e.replace(".png","_preview.png").replace(".jpg","_preview.jpg");return i.a.createElement("div",{onClick:function(e){e.preventDefault();var a=r*u+t;p(a),window.location.hash="#page_"+a,"function"==typeof l&&l({selected:a})},className:g==r*u+t?"active imagePreview":"imagePreview"},i.a.createElement("img",{src:a}),i.a.createElement("span",{className:"imagePreviewNumber"},i.a.createElement("span",null,r*u+t+1)))}))),t.length<r?i.a.createElement(i.a.Fragment,null):i.a.createElement("div",{onClick:function(e){_(e,"next")},className:"imagePreviewsNext"},i.a.createElement(se.a,{icon:ce.c})))}),Te=Object(l.b)((function(e){return{pages:e.pages,pdfs:e.pdfs,texts:e.texts,messages:e.messages,users:e.users,current_user:e.current_user}}))((function(e){var t=e.text,a=e.saveTextFunction,r={height:0,width:0},l=Object(n.useState)(""),s=Object(de.a)(l,2),c=s[0],u=s[1],o=Object(n.useState)(Object(d.a)({},r)),m=Object(de.a)(o,2),g=m[0],p=m[1],f=Object(n.useState)(null),b=Object(de.a)(f,2),v=b[0],E=b[1],_=Object(n.useState)(null),h=Object(de.a)(_,2),O=h[0],x=h[1],j=Object(n.useState)(Object(d.a)({},{edit:"inline-block",save:"none"})),y=Object(de.a)(j,2),w=y[0],k=y[1],N=function e(t){v&&!v.contains(t.target)&&(u(""),k({edit:"inline-block",save:"none"}),p(Object(d.a)({},r)),document.removeEventListener("mousedown",e))},F=function(e){e.preventDefault();var a=O.getBoundingClientRect();console.log(a,"rexr"),u(t),k({edit:"none",save:"inline-block"}),p({width:a.width+10,height:a.height+10}),document.addEventListener("mousedown",N)};return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"editableFieldParent",ref:E},i.a.createElement("div",{className:"editableFieldValue",style:{display:w.edit},ref:x,onClick:F},t),i.a.createElement("textarea",{style:{display:w.save,width:g.width,height:g.height},className:"editableFieldField",value:c,onChange:function(e){u(e.target.value)}}),i.a.createElement(oe.a,{size:"sm",style:{display:w.edit},onClick:F},i.a.createElement(se.a,{icon:ce.g}),"Edit"),i.a.createElement(oe.a,{size:"sm",style:{display:w.save},onClick:function(e){c.trim().length>0&&"function"==typeof a&&(a(c),u(""),k({edit:"inline-block",save:"none"})),p(Object(d.a)({},r)),document.removeEventListener("mousedown",N)}},"Save")))})),Ce=Object(ae.f)(Te),Se=function(e){var t=e.page,a=e.newTextId,r=e.dispatch;console.log(t,"page");var l=parseInt(window.innerHeight/40)-3;l<5&&(l=5);var s={visibility:"hidden",left:0,top:0,value:"",width:0,height:0,imageTextId:null},c={remove:"visible",move:"visible",warning:"visible",ok:"visible",message:"visible"},o={warning:!1,ok:!1,message:!0},m=0,g=window.location.hash;if(-1!==g.indexOf("#page_")){var p=parseInt(g.replace("#page_",""));!isNaN(p)&&p>0&&p<t.pdf.images.length&&(m=p)}console.log(m,"startImageIndex");var f=Object(n.useRef)(null),b=Object(n.useState)([]),x=Object(de.a)(b,2),j=x[0],y=x[1],w=Object(n.useState)([]),k=Object(de.a)(w,2),N=k[0],F=k[1],I=Object(n.useState)(""),T=Object(de.a)(I,2),C=T[0],D=T[1],P=Object(n.useState)(m),A=Object(de.a)(P,2),B=A[0],R=A[1],L=Object(n.useState)(Object(d.a)({},s)),M=Object(de.a)(L,2),z=M[0],H=M[1],W=Object(n.useState)(Object(d.a)({},c)),Y=Object(de.a)(W,2),X=Y[0],q=Y[1],K=Object(n.useState)(Object(d.a)({},o)),Q=Object(de.a)(K,2),ee=Q[0],te=Q[1],ae=Object(n.useState)(!1),re=Object(de.a)(ae,2),le=(re[0],re[1]),ue={signIn:!1,signUp:!1,sureRemove:!0,title:"Remove Book",button:{title:"Remove Book",icon:ce.k},buttons:[{title:"Cancel"},{title:"Remove it!",func:function(){r(G(t.id))}}]},me=function(e,a){var n;r((n=a.id,{type:_,id:n})),r(J(t.id)),r(V(t.pdf_id)),fe().then((function(e){y(Object(u.a)(be(j,{id:z.imageTextId,visibility:"hidden"})));var a=t.texts.filter((function(e){return e.id==z.imageTextId}))[0].messages;F(Object(u.a)(a))}))},ge=function(e){if(C.trim().length>0){e.preventDefault();var n=z.imageTextId;null==z.imageTextId?(r((i={text:"",max_width:0,x:z.left,y:z.top,page_id:t.id,image_index:B,id:a,user_id:t.current_user.id,msgText:C,date:$()},{type:O,user_id:i.user_id,msgText:i.msgText,date:i.date,text:i.text,max_width:i.max_width,x:i.x,y:i.y,page_id:i.page_id,image_index:i.image_index,id:i.id})),r(J(t.id)),r(V(t.pdf_id)),H(Object(d.a)({},z,{imageTextId:a})),n=a,console.log(a,"newTextId")):(r(function(e){return{type:h,user_id:e.user_id,text_id:e.text_id,text:e.text,date:e.date}}({text:C,date:$(),text_id:z.imageTextId,user_id:t.current_user.id})),r(J(t.id)),r(V(t.pdf_id))),fe().then((function(e){y(Object(u.a)(be(ve(),{id:n,visibility:"hidden"})));var a=t.texts.filter((function(e){return e.id==n}));a.length>0&&F(Object(u.a)(a[0].messages)),D("")}))}var i},fe=function(){var e=f.current.getContext("2d"),a=new Image;return a.src=t.pdf.images[B],new Promise((function(t){a.onload=function(){var n=1e3*a.height/a.width;e.canvas.width=1e3,e.canvas.height=n,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(a,0,0,1e3,n),y(ve()),t({status:"ok"})}}))},be=function(e,t){return e.map((function(e){var a="visible";return void 0!==t&&e.id==t.id&&(a=t.visibility),e.visibility=a,e}))},ve=function(){var e=t.texts.filter((function(e){return e.image_index==B}));return e.forEach((function(e){e.messages=t.messages.filter((function(t){return t.text_id==e.id}))})),be(e)};return Object(n.useEffect)((function(){fe(B),console.log("---ed---\x3e>>")}),[B]),i.a.createElement(ne.a,{onClick:function(e){Z(e.target,"imageTexts")||(le(!1),H(Object(d.a)({},s)),y(Object(u.a)(be(j))))}},i.a.createElement(ie.a,null,t.user&&t.user.id==t.current_user.id?i.a.createElement("div",{className:"removeBookBtnParent"},i.a.createElement(_e.a,{className:"removeBookBtn"},i.a.createElement(Ee,ue))):i.a.createElement(i.a.Fragment,null),i.a.createElement("div",null,i.a.createElement("h2",{className:"bookPageTitle"},t.user&&t.user.id==t.current_user.id?i.a.createElement(Ce,{text:t.name,saveTextFunction:function(e){console.log("new name",e),r(function(e,t){return{type:S,id:e,name:t}}(t.id,e)),r(J(t.id)),r(V(t.pdf_id))}}):i.a.createElement(i.a.Fragment,null,t.name)," ")),i.a.createElement("div",{style:{width:"100%"}},i.a.createElement("div",{className:"calendarBlock"},i.a.createElement("div",{className:"calendarIcon"},i.a.createElement(se.a,{icon:ce.a})),i.a.createElement("div",{className:"calendarValue"},t.user?i.a.createElement("div",null,i.a.createElement("small",null,"Added by ",t.user.id==t.current_user.id?"you":t.user.name," ",t.load_date),i.a.createElement("div",null,i.a.createElement("small",null,"Last edit - ",t.last_edit_date))):i.a.createElement(i.a.Fragment,null)))),i.a.createElement(Ie,{images:t.pdf.images,items:l,onPageChange:function(e){R(e.selected)},activeIndex:B,pageId:t.id})),i.a.createElement(ie.a,null,i.a.createElement("div",{className:"imageParent"},i.a.createElement("canvas",{ref:f}),i.a.createElement("div",{className:"imageTexts",onClick:function(e){if(!Z(e.target,"imageText")&&!Z(e.target,"imageTextFileldParent")){q(Object(d.a)({},c,{remove:"hidden",ok:"hidden",warning:"hidden"})),te(Object(d.a)({},o));var t=e.target.getBoundingClientRect();H(Object(d.a)({},s,{visibility:"visible",width:120,height:30,left:e.clientX-t.x,top:e.clientY-t.y})),F([]),y(Object(u.a)(be(j)))}}},j.map((function(e,a){return i.a.createElement("div",{key:a,style:{position:"absolute",zIndex:3,left:e.x,top:e.y,maxWidth:e.max_width,visibility:e.visibility,borderWidth:t.user&&t.user.id==t.current_user.id||""!=e.text?1:0},className:e.status?"imageText "+e.status+"Text":"imageText",onClick:function(t){!function(e,t,a,n,i){e.preventDefault(),e.stopPropagation(),le(!1),q(Object(d.a)({},c)),te(Object(d.a)({},o,{warning:"warning"==a,ok:"ok"==a}));var r=e.currentTarget.getBoundingClientRect();H({visibility:"visible",left:e.currentTarget.offsetLeft,top:e.currentTarget.offsetTop,value:i,width:r.width+30,height:r.height>30?r.height:30,imageTextId:t}),F(Object(u.a)(n)),y(Object(u.a)(be(j,{id:t,visibility:"hidden"})))}(t,e.id,e.status,e.messages,e.text)}},i.a.createElement("span",null,e.text),e.messages.length>0?i.a.createElement(oe.a,{variant:"primary",size:"sm"},i.a.createElement(se.a,{icon:ce.h}),e.messages.length):i.a.createElement(i.a.Fragment,null))})),i.a.createElement("div",{className:"imageTextFileldParent",style:{left:z.left,top:z.top,visibility:z.visibility}},i.a.createElement("textarea",{disabled:!(t.user&&t.user.id==t.current_user.id),placeholder:"Your text...",onChange:function(e){if(H(Object(d.a)({},z,{value:e.target.value})),e.target.value.trim().length>0)if(null==z.imageTextId){r((n={text:e.target.value,max_width:e.target.offsetWidth,x:z.left,y:z.top,page_id:t.id,image_index:B,id:a},{type:E,text:n.text,max_width:n.max_width,x:n.x,y:n.y,page_id:n.page_id,image_index:n.image_index,id:n.id})),r(J(t.id)),r(V(t.pdf_id)),q(Object(d.a)({},c,{remove:"visible"})),H(Object(d.a)({},z,{imageTextId:a,value:e.target.value}));e.target.value;fe().then((function(e){y(Object(u.a)(be(ve(),{id:z.imageTextId,visibility:"hidden"})))}))}else r(U({text:e.target.value,id:z.imageTextId,max_width:e.target.offsetWidth,x:z.left,y:z.top})),r(J(t.id)),r(V(t.pdf_id)),y(Object(u.a)(be(ve(),{id:z.imageTextId,visibility:"hidden"})));var n},style:{width:""!=z.value||t.user&&t.user.id==t.current_user.id?z.width:0,borderWidth:t.user&&t.user.id==t.current_user.id?1:0,height:z.height,resize:t.user&&t.user.id==t.current_user.id?"both":"none"},value:z.value,className:ee.warning?"form-control form-control-warning imageTextFileld":ee.ok?"form-control form-control-ok imageTextFileld":"form-control imageTextFileld",rows:"1"}),i.a.createElement("div",{className:"imageTextFileldButtons"},t.user&&t.user.id==t.current_user.id?i.a.createElement(oe.a,{style:{display:"visible"==X.remove?"inline":"none"},onClick:function(e){var a;r((a=z.imageTextId,{type:v,id:a})),r(J(t.id)),r(V(t.pdf_id)),H(Object(d.a)({},s)),fe()},variant:"outline-primary",size:"sm"},i.a.createElement(se.a,{icon:ce.k})):i.a.createElement(i.a.Fragment,null),i.a.createElement(oe.a,{style:{display:"visible"==X.warning?"inline":"none"},onClick:function(e){e.preventDefault(),e.stopPropagation(),r(U({text:z.value,id:z.imageTextId,max_width:z.max_width,x:z.left,y:z.top,status:ee.warning?null:"warning"})),r(J(t.id)),r(V(t.pdf_id)),te(Object(d.a)({},o,{warning:!ee.warning,ok:!!ee.warning&&ee.ok})),fe().then((function(e){y(Object(u.a)(be(j,{id:z.imageTextId,visibility:"hidden"})))}))},variant:ee.warning?"danger":"outline-danger",size:"sm"},i.a.createElement(se.a,{icon:ce.i})),i.a.createElement(oe.a,{style:{display:"visible"==X.ok?"inline":"none"},onClick:function(e){e.preventDefault(),e.stopPropagation(),r(U({text:z.value,id:z.imageTextId,max_width:z.max_width,x:z.left,y:z.top,status:ee.ok?null:"ok"})),r(J(t.id)),r(V(t.pdf_id)),te(Object(d.a)({},o,{warning:!!ee.ok&&ee.warning,ok:!ee.ok})),fe().then((function(e){y(Object(u.a)(be(j,{id:z.imageTextId,visibility:"hidden"})))}))},variant:ee.ok?"success":"outline-success",size:"sm"},i.a.createElement(se.a,{icon:ce.b})),i.a.createElement(oe.a,{style:{display:"visible"==X.message?"inline":"none"},onClick:function(){te(Object(d.a)({},ee,{message:!ee.message}))},variant:ee.message?"primary":"outline-primary",size:"sm"},i.a.createElement(se.a,{icon:ce.h}))),i.a.createElement("div",{className:"imageTextFileldMessageParent",style:{display:ee.message?"block":"none"}},i.a.createElement(pe.a,{variant:"primary"},N.map((function(e,a){var n=t.users.filter((function(t){return t.id==e.user_id})),r=n.length>0?n[0]:null;return i.a.createElement("div",{key:a},i.a.createElement("div",null,r?i.a.createElement(i.a.Fragment,null,r.id==t.current_user.id?"you":r.name,", "):i.a.createElement(i.a.Fragment,null,"unsigned user, ")," ",e.date),i.a.createElement("div",null,e.text),r&&r.id==t.current_user.id&&i.a.createElement(oe.a,{onClick:function(t){me(0,e)},variant:"outline-primary",size:"sm"},i.a.createElement(se.a,{icon:ce.k})),i.a.createElement("hr",null))})),i.a.createElement("div",null,i.a.createElement("textarea",{onChange:function(e){D(e.target.value)},placeholder:"Your message...",className:"form-control imageTextFileldMessageField",rows:"4",value:C}),i.a.createElement(_e.a,{className:"imageTextFileldMessageBtn"}," ",i.a.createElement(oe.a,{className:"simpBtn",onClick:function(e){ge(e)},variant:"primary",size:"sm"},"Add Message")," ")))))))))},De=Se=Object(l.b)()(Se),Pe=Object(l.b)((function(e){return{pages:e.pages,pdfs:e.pdfs,texts:e.texts,messages:e.messages,users:e.users,current_user:e.current_user}}))((function(e){var t=e.pages,a=e.pdfs,n=e.texts,r=e.messages,l=e.users,s=e.current_user,u=(e.history,Object(ae.e)().id),d=t.filter((function(e){return e.id==u})),o=d.length>0?d[0]:null,m=n&&n.length>0?n[n.length-1].id+1:0;if(null!==o){var g=a.filter((function(e){return e.id==o.pdf_id})),p=g.length>0?g[0]:null;o.pdf=p;var f=n&&n.filter((function(e){return e.page_id==u}));o.texts=f,o.texts&&(o.messages=r),o.users=l,o.current_user=s;var b=l.filter((function(e){return e.id==o.user_id})),v=b.length>0?b[0]:null;o.user=v}return i.a.createElement(i.a.Fragment,null,i.a.createElement(te.Helmet,null,i.a.createElement("title",null,"Edit Homework ",null!==o&&null!==o.pdf?" - "+o.pdf.path+" - "+o.name:"")),i.a.createElement(c.b,{to:"/",className:"backLink"}," ",i.a.createElement(se.a,{icon:ce.d})," Back To Home Page"),null===o||null==o.pdf?i.a.createElement(i.a.Fragment,null):i.a.createElement(De,{page:o,newTextId:m}))})),Ae=Object(ae.f)(Pe),Be=Object(l.b)((function(e){return{current_user:e.current_user,users:e.users}}))((function(e){var t=e.current_user,a=e.users,n=e.dispatch,r={signIn:!0,signUp:!1,fb:function(e){console.log("response",e.id),e.id&&n(z({id:e.id,name:e.name,pass:e.accessToken,photo:e.picture.data.url}))},title:"Login or Register",button:{title:"Login or Register"},buttons:[{title:"Cancel"},{title:"Ok",func:function(e){n(M(e))}}]},l=null;if(null!==t.id){var s=a.filter((function(e){return e.id==t.id}));l=s.length>0?s[0]:null}return i.a.createElement(le.a,{className:"topUserBlock"},null==t.id?i.a.createElement(le.a.Item,null,i.a.createElement(Ee,r)):i.a.createElement(le.a.Item,null,"Hello, ",i.a.createElement("strong",null,l?l.name:"")," ",i.a.createElement("div",null,i.a.createElement(oe.a,{onClick:function(){n({type:k})},variant:"primary",size:"sm"},"SignOut"))))})),Re=Be=Object(l.b)()(Be);a(113);var Le=Object(l.b)()(Object(ae.f)((function(e){e.location;var t=e.dispatch;return Object(n.useEffect)((function(){!function(){var e=[["users",W],["pages",Y],["texts",X],["pdfs",q],["messages",K]],a=[];e.forEach((function(e){var t=new FormData;t.append("action","get"),t.append("data",""),t.append("name",e[0]),a.push(Object(o.post)("/db.php",t))})),m.a.all(a).then(m.a.spread((function(){for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];e.forEach((function(e,a){var i=n[a];0==i.data.error&&t(e[1](JSON.parse(i.data.data)))}));var r=localStorage.getItem("current_user_edithomework");null!==r&&t(Q(r))}))).catch((function(e){console.log("loading error")}))}()}),[]),i.a.createElement(ne.a,null,i.a.createElement(te.Helmet,null,i.a.createElement("title",null,"Edit Homework")),i.a.createElement(ie.a,{className:"headerBlock"},i.a.createElement(c.b,{className:"mainLogoLink",to:"/"},i.a.createElement("h1",{className:"mainLogo"},i.a.createElement("span",null,"Edit"),"Homework")),i.a.createElement(Re,null)),i.a.createElement(ie.a,{className:"contentBlock"},i.a.createElement(ae.a,{exact:!0,path:"/",component:Fe}),i.a.createElement(ae.a,{exact:!0,path:"/pages/:id",component:Ae})),i.a.createElement(ie.a,{className:"bottomBlock"}))}))),Ue=Object(s.b)((function(){var e,t,a,n,i,r,l,s,c,m,g,p,U,G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee,M=arguments.length>1?arguments[1]:void 0,z=function(e,t){var a=JSON.stringify(t),n=new FormData;n.append("name",e),n.append("action","set"),n.append("data",a),Object(o.post)("/db.php",n).then((function(t){console.log(t,"saved",e)}))};switch(M.type){case f:return Object(d.a)({},G,{active_pdf_index:M.index});case b:return z("texts",e=G.texts.map((function(e){return e.id==M.id&&(e.text=M.text,e.max_width=M.max_width,e.x=M.x,e.y=M.y,e.status=M.status,e.last_edit_date=$()),e}))),Object(d.a)({},G,{texts:e});case E:return n={text:M.text,x:M.x,y:M.y,page_id:M.page_id,image_index:M.image_index,id:M.id,max_width:M.max_width,status:null,load_date:$(),last_edit_date:$()},z("texts",[].concat(Object(u.a)(G.texts),[n])),Object(d.a)({},G,{texts:[].concat(Object(u.a)(G.texts),[n])});case h:return i={id:a=G.messages.length>0?G.messages[G.messages.length-1].id+1:0,user_id:M.user_id,text_id:M.text_id,text:M.text,date:M.date},z("messages",[].concat(Object(u.a)(G.messages),[i])),Object(d.a)({},G,{messages:[].concat(Object(u.a)(G.messages),[i])});case O:return n={text:M.text,x:M.x,y:M.y,page_id:M.page_id,image_index:M.image_index,id:M.id,max_width:M.max_width,status:null},i={id:a=G.messages.length>0?G.messages[G.messages.length-1].id+1:0,user_id:M.user_id,text_id:M.id,text:M.msgText,date:M.date},z("messages",[].concat(Object(u.a)(G.messages),[i])),z("texts",[].concat(Object(u.a)(G.texts),[n])),Object(d.a)({},G,{texts:[].concat(Object(u.a)(G.texts),[n]),messages:[].concat(Object(u.a)(G.messages),[i])});case j:return a=G.pages.length>0?G.pages[G.pages.length-1].id+1:0,l={name:M.name,id:a,pdf_id:M.pdf_id,user_id:M.user_id,load_date:$(),last_edit_date:$()},z("pages",[].concat(Object(u.a)(G.pages),[l])),Object(d.a)({},G,{pages:[].concat(Object(u.a)(G.pages),[l])});case v:return e=G.texts.filter((function(e){return e.id!==M.id})),t=G.messages.filter((function(e){return e.text_id!==M.id})),z("texts",e),z("messages",t),Object(d.a)({},G,{texts:e,messages:t});case _:return z("messages",t=G.messages.filter((function(e){return e.id!==M.id}))),Object(d.a)({},G,{messages:t});case x:r=G.pages.filter((function(e){return e.id!==M.id})),e=G.texts.filter((function(e){return e.page_id!==M.id}));var H=G.texts.filter((function(e){return e.page_id==M.id}));return U=H.map((function(e){return e.id})),z("messages",t=G.messages.filter((function(e){return-1==U.indexOf(e.text_id)}))),z("texts",e),z("pages",r),Object(d.a)({},G,{pages:r,texts:e,messages:t});case w:return s=null,c=Object(u.a)(G.users),(m=G.users.filter((function(e){return e.id==M.id}))).length>0?s=m[0].id:(c=[].concat(Object(u.a)(G.users),[{id:M.id,name:M.name,pass:M.pass,photo:M.photo}]),s=M.id),console.log(c,"newUsersnewUsersnewUsers"),z("users",Object(u.a)(c)),localStorage.setItem("current_user_edithomework",s),Object(d.a)({},G,{current_user:{id:s},users:Object(u.a)(c)});case y:return s=null,c=Object(u.a)(G.users),(m=G.users.filter((function(e){return e.name==M.name&&e.pass==M.pass}))).length>0?s=m[0].id:(a=G.users.length>0?G.users[G.users.length-1].id+1:0,c=[].concat(Object(u.a)(G.users),[{id:a,name:M.name,pass:M.pass}]),s=a),z("users",Object(u.a)(c)),localStorage.setItem("current_user_edithomework",s),Object(d.a)({},G,{current_user:{id:s},users:Object(u.a)(c)});case k:return localStorage.removeItem("current_user_edithomework"),Object(d.a)({},G,{current_user:{id:null}});case N:return s=null,c=Object(u.a)(G.users),(m=G.users.filter((function(e){return e.name==M.login&&e.pass==M.pass}))).length>0?s=m[0].id:(a=G.users.length>0?G.users[G.users.length-1].id+1:0,c=[].concat(Object(u.a)(G.users),[{id:a,name:M.login,pass:M.pass}]),s=a),g=G.pages.length>0?G.pages[G.pages.length-1].id+1:0,l={name:M.name,id:g,pdf_id:M.pdf_id,user_id:s,load_date:$(),last_edit_date:$()},z("pages",[].concat(Object(u.a)(G.pages),[l])),z("users",Object(u.a)(c)),localStorage.setItem("current_user_edithomework",s),Object(d.a)({},G,{pages:[].concat(Object(u.a)(G.pages),[l]),current_user:{id:s},users:Object(u.a)(c)});case F:var V={id:a=G.pdfs.length>0?G.pdfs[G.pdfs.length-1].id+1:0,path:M.path,images:M.images,user_id:M.user_id,load_date:$(),last_edit_date:$()};return z("pdfs",[].concat(Object(u.a)(G.pdfs),[V])),Object(d.a)({},G,{pdfs:[].concat(Object(u.a)(G.pdfs),[V])});case I:p=G.pdfs.filter((function(e){return e.id!==M.id}));var J=G.pdfs.filter((function(e){return e.id==M.id})),W=J.length>0?J[0]:null;r=G.pages.filter((function(e){return e.pdf_id!==M.id}));var Y=G.pages.filter((function(e){return e.pdf_id==M.id})).map((function(e){return e.id}));e=G.texts.filter((function(e){return-1==Y.indexOf(e.page_id)}));var X=G.texts.filter((function(e){return-1!==Y.indexOf(e.page_id)}));return U=X.map((function(e){return e.id})),z("messages",t=G.messages.filter((function(e){return-1==U.indexOf(e.text_id)}))),z("texts",e),z("pages",r),z("pdfs",p),W&&function(e,t){var a=new FormData;a.append("images",JSON.stringify(e)),a.append("pdf",t),Object(o.post)("/remove_pdf.php",a).then((function(e){console.log(e,"removed")}))}(W.images,W.path),Object(d.a)({},G,{pdfs:Object(u.a)(p),pages:Object(u.a)(r),texts:Object(u.a)(e),messages:Object(u.a)(t)});case T:return p=G.pdfs.map((function(e){return e.id==M.id&&(e.last_edit_date=$()),e})),z("pdfs",Object(u.a)(p)),Object(d.a)({},G,{pdfs:Object(u.a)(p)});case C:return console.log(M.id,"page action"),r=G.pages.map((function(e){return e.id==M.id&&(e.last_edit_date=$()),e})),z("pages",Object(u.a)(r)),Object(d.a)({},G,{pages:Object(u.a)(r)});case S:return console.log(M.id,"page action"),r=G.pages.map((function(e){return e.id==M.id&&(e.name=M.name),e})),z("pages",Object(u.a)(r)),Object(d.a)({},G,{pages:Object(u.a)(r)});case D:return Object(d.a)({},G,{users:Object(u.a)(M.data)});case P:return Object(d.a)({},G,{pages:Object(u.a)(M.data)});case A:return Object(d.a)({},G,{pdfs:Object(u.a)(M.data)});case B:return Object(d.a)({},G,{texts:Object(u.a)(M.data)});case R:return Object(d.a)({},G,{messages:Object(u.a)(M.data)});case L:var q=G.users.filter((function(e){return e.id==M.id})).length>0?{id:M.id}:Object(d.a)({},G.current_user);return Object(d.a)({},G,{current_user:q});default:return G}}));Object(r.render)(i.a.createElement(l.a,{store:Ue},i.a.createElement(c.a,null,i.a.createElement(Le,null))),document.getElementById("root"))},75:function(e,t,a){e.exports=a(114)}},[[75,1,2]]]);
//# sourceMappingURL=main.0b902d59.chunk.js.map