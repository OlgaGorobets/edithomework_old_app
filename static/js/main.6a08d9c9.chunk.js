(this.webpackJsonpmy_editor=this.webpackJsonpmy_editor||[]).push([[0],{106:function(e,t,a){},107:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(22),s=a(9),l=a(42),c=a(29),d=a(7),o=a(4),u=a(25),m=a.n(u),p=a(54),g=a.n(p),f="CHANGE_ACTIVE_PDF",_="CHANGE_TEXT_VALUE",h="REMOVE_TEXT_VALUE",b="ADD_NEW_TEXT_VALUE",v="REMOVE_MESSAGE",E="ADD_NEW_MESSAGE",x="ADD_FIRST_MESSAGE",j="REMOVE_PAGE",O="ADD_NEW_PAGE",y="SIGN_FORM",w="SIGN_OUT_FORM",N="SIGN_FORM_AND_ADD_NEW_PAGE",k="ADD_PDF",F="REMOVE_PDF",I="CHANGE_PDF_DATE",T="CHANGE_PAGE_DATE",P="LOAD_USERS",S="LOAD_PAGES",A="LOAD_PDFS",C="LOAD_TEXTS",D="LOAD_MESSAGES",R="LOAD_CURRENT_USER";function B(e){return{type:f,index:e}}function L(e){return{type:_,id:e.id,text:e.text,max_width:e.max_width,x:e.x,y:e.y,status:e.status}}function U(e){return{type:j,id:e}}function G(e){return{type:y,name:e.login,pass:g.a.hex_md5(e.pass)}}function M(e){return{type:k,path:e.path,images:e.images,user_id:e.user_id}}function z(e){return{type:I,id:e}}function H(e){return{type:T,id:e}}function V(e){return{type:P,data:e}}function J(e){return{type:S,data:e}}function W(e){return{type:C,data:e}}function Y(e){return{type:A,data:e}}function X(e){return{type:D,data:e}}function q(e){return{type:R,id:e}}function K(e,t){return!!(e.className&&e.className.split&&e.className.split(" ").indexOf(t)>=0)||e.parentNode&&K(e.parentNode,t)}function Q(e){var t=e?new Date(e):new Date,a=""+["Jan","Feb","March","Apr","May","June","July","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],n=""+t.getDate(),i=t.getFullYear(),r=t.getHours(),s=t.getMinutes();return a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),n+" "+a+","+i+" "+r+":"+s}var Z={current_user:{id:0},users:[{id:0,name:"OlkaOlkaOlkaOlka OlkaOlkaOlkaOlkaOlkaOlka",pass:"123"}],pdfs:[{path:"some path1 some path1 some path1 some path1 some path1some path1 some path1 some path1",id:0,user_id:0,load_date:"",last_edit_date:"",images:["/uploads/photos/photo_pdf \u0431\u0438\u043b\u0435\u0442\u0430.png","../photos/2.jpg","../photos/3.jpg","../photos/4.jpg","../photos/5.jpg","../photos/6.jpg","../photos7.jpg","../photos/8.jpg"]},{path:"some path1",id:1,user_id:0,load_date:"",last_edit_date:"",images:["/uploads/photos/photo_pdf \u0431\u0438\u043b\u0435\u0442\u0430.png","../photos/2.jpg","../photos/3.jpg","../photos/4.jpg","../photos/5.jpg","../photos/6.jpg","../photos7.jpg","../photos/8.jpg"]},{path:"some path1",id:2,user_id:0,load_date:"",last_edit_date:"",images:["/uploads/photos/photo_pdf \u0431\u0438\u043b\u0435\u0442\u0430.png","../photos/2.jpg","../photos/3.jpg","../photos/4.jpg","../photos/5.jpg","../photos/6.jpg","../photos7.jpg","../photos/8.jpg"]},{path:"some path1",id:3,user_id:0,load_date:"",last_edit_date:"",images:["/uploads/photos/photo_pdf \u0431\u0438\u043b\u0435\u0442\u0430.png","../photos/2.jpg","../photos/3.jpg","../photos/4.jpg","../photos/5.jpg","../photos/6.jpg","../photos7.jpg","../photos/8.jpg"]},{path:"some path1",id:4,user_id:0,load_date:"",last_edit_date:"",images:["/uploads/photos/photo_pdf \u0431\u0438\u043b\u0435\u0442\u0430.png","../photos/2.jpg","../photos/3.jpg","../photos/4.jpg","../photos/5.jpg","../photos/6.jpg","../photos7.jpg","../photos/8.jpg"]},{path:"some path1",id:5,user_id:0,load_date:"",last_edit_date:"",images:["/uploads/photos/photo_pdf \u0431\u0438\u043b\u0435\u0442\u0430.png","../photos/2.jpg","../photos/3.jpg","../photos/4.jpg","../photos/5.jpg","../photos/6.jpg","../photos7.jpg","../photos/8.jpg"]},{path:"some path1",id:6,user_id:0,load_date:"",last_edit_date:"",images:["/uploads/photos/photo_pdf \u0431\u0438\u043b\u0435\u0442\u0430.png","../photos/2.jpg","../photos/3.jpg","../photos/4.jpg","../photos/5.jpg","../photos/6.jpg","../photos7.jpg","../photos/8.jpg"]}],texts:[{text:"testing text1",x:0,y:0,page_id:0,image_index:0,id:0,max_width:"auto",status:"ok"}],messages:[],active_pdf_index:0,pages:[{name:"page 1 page 1page 1page 1 page 1page 1page 1page 1page 1page 1page 1page 1page 1page 1page 1",id:0,pdf_id:0,user_id:0},{name:"page 2",id:1,pdf_id:0,user_id:0},{name:"page 2",id:2,pdf_id:0,user_id:0},{name:"page 2",id:3,pdf_id:0,user_id:0},{name:"page 2",id:4,pdf_id:0,user_id:0},{name:"page 2",id:5,pdf_id:0,user_id:0},{name:"page 2",id:6,pdf_id:0,user_id:0},{name:"page 2",id:7,pdf_id:0,user_id:0},{name:"page 2",id:8,pdf_id:0,user_id:0},{name:"page 2",id:9,pdf_id:0,user_id:0}]};var $=a(30),ee=a(46),te=a(23),ae=a(32),ne=a(15),ie=a(11),re=a(8),se=a(43),le=a(12),ce=a(10),de=a(20),oe=a(49),ue=a(34),me=a(40),pe=function(e){var t={login:"",pass:"",name:""},a={login:!1,pass:!1,name:!1},r={name:e.addPage,login:e.signIn,pass:e.signIn},s=Object(n.useState)(!1),l=Object(le.a)(s,2),c=l[0],d=l[1],u=Object(n.useState)(Object(o.a)({},t)),m=Object(le.a)(u,2),p=m[0],g=m[1],f=Object(n.useState)(Object(o.a)({},a)),_=Object(le.a)(f,2),h=_[0],b=_[1],v=function(){return d(!1)},E=function(e){g(Object(o.a)({},p,Object(se.a)({},e.target.getAttribute("name"),e.target.value))),b(Object(o.a)({},a))},x="",j="",O="",y="";return e.signIn&&(x=i.a.createElement(me.a,null,i.a.createElement(me.a.Body,null,i.a.createElement(me.a.Title,null,"Login or Register ",i.a.createElement("small",null,"(if you don't have an account)")),i.a.createElement(me.a.Text,null,i.a.createElement("div",null,i.a.createElement(oe.a.Control,{name:"login",type:"text",value:p.login,placeholder:"Login",onChange:E}),h.login?i.a.createElement(ue.a,{variant:"danger"},"Required field"):i.a.createElement(i.a.Fragment,null)),i.a.createElement("div",null,i.a.createElement(oe.a.Control,{name:"pass",type:"password",value:p.pass,placeholder:"Password",onChange:E}),h.pass?i.a.createElement(ue.a,{variant:"danger"},"Required field"):i.a.createElement(i.a.Fragment,null)))))),e.sureRemove&&(j=i.a.createElement("div",null,"Are you sure? You won't be able to recover this page! ")),e.sureRemovePdf&&(O=i.a.createElement("div",null,"Are you sure? You won't be able to recover this Pdf and all pages created from this Pdf will be removed! ")),e.addPage&&(y=i.a.createElement("div",null,i.a.createElement(oe.a.Control,{type:"text",name:"name",value:p.name,placeholder:"Name",onChange:E}),h.name?i.a.createElement(ue.a,{variant:"danger"},"Required field"):i.a.createElement(i.a.Fragment,null))),i.a.createElement(i.a.Fragment,null,i.a.createElement(ce.a,{size:e.button.large?"lg":"sm",variant:"primary",onClick:function(){return d(!0)}},e.button.icon?i.a.createElement(ie.a,{icon:e.button.icon}):"",e.button.title),i.a.createElement(de.a,{show:c,onHide:v,animation:!1},i.a.createElement(de.a.Header,{closeButton:!0},i.a.createElement(de.a.Title,null,e.title)),i.a.createElement(de.a.Body,null,x,"",j,O,y),i.a.createElement(de.a.Footer,null,e.buttons.map((function(e,a){return i.a.createElement(ce.a,{size:"sm",key:a,variant:"secondary",onClick:function(){(function(){var e=!0,t={};for(var a in r)if(r[a]){var n=0==p[a].trim().length;t[a]=n,n&&(e=!1)}else t[a]=!1;return b(Object(o.a)({},t)),e})()&&("function"===typeof e.func&&e.func(p),v(),g(Object(o.a)({},t)))}},e.title)})))))},ge=a(28),fe=function(e){var t=e.pdf,a=e.dispatch,n={signIn:!1,signUp:!1,sureRemovePdf:!0,title:"Remove Pdf File",button:{title:"Remove",icon:re.i},buttons:[{title:"Cancel"},{title:"Remove it!",func:function(){var e;a((e=t.id,{type:F,id:e}))}}]};return i.a.createElement(ne.a.Item,{className:t.is_active?"list-group-item-primary":""},i.a.createElement("div",{className:"itemTitle"},i.a.createElement(ce.a,{variant:"link",onClick:function(e){e.preventDefault(),a(B(t.index))}},i.a.createElement("span",null,t.path))),i.a.createElement("div",{className:"absBtns"},i.a.createElement("div",null,i.a.createElement(ce.a,{size:"sm",onClick:function(e){e.preventDefault(),a(B(t.index))}},"Show Pages")),null!==t.current_user.id&&t.user&&t.current_user.id==t.user.id?i.a.createElement(ge.a,{className:"mr-2"},i.a.createElement(pe,n)):i.a.createElement(i.a.Fragment,null)),i.a.createElement("div",{className:"calendarBlock"},i.a.createElement("div",{className:"calendarIcon"},i.a.createElement(ie.a,{icon:re.a})),i.a.createElement("div",{className:"calendarValue"},t.user?i.a.createElement("div",null,i.a.createElement("small",null,"Loaded by ",t.user.id==t.current_user.id?"you":t.user.name," ",t.load_date),i.a.createElement("div",null,i.a.createElement("small",null,"Last pages edits - ",t.last_edit_date))):i.a.createElement(i.a.Fragment,null))))},_e=fe=Object(s.b)()(fe),he=a(70),be=Object(s.b)((function(e){return{current_user:e.current_user}}))((function(e){var t=e.current_user,a=e.dispatch,r=Object(n.useState)(null),s=Object(le.a)(r,2),l=s[0],c=s[1],d=Object(n.useState)(null),m=Object(le.a)(d,2),p=m[0],g=m[1],f=Object(n.useState)({show:!1,title:"",text:""}),_=Object(le.a)(f,2),h=_[0],b=_[1],v=function(e){var t=new FormData;t.append("file",e);return Object(u.post)("/upload.php",t,{headers:{"content-type":"multipart/form-data"}})};return i.a.createElement(i.a.Fragment,null,i.a.createElement("form",{onSubmit:function(e){e.preventDefault(),l&&g(!0),v(l).then((function(e){g(!1);var n=e.data;0==n.error&&a(M({path:n.file,images:JSON.parse(n.images),user_id:t.id}))}))}},i.a.createElement("h6",null,"Upload Pdf File"),p?i.a.createElement("span",null,i.a.createElement(he.a,{animation:"border",variant:"secondary"}),"Wait please, File is Loading..."):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"custom-file"},i.a.createElement("input",{type:"file",className:"custom-file-input",id:"inputGroupFile01","aria-describedby":"inputGroupFileAddon01",onChange:function(e){c(e.target.files[0]),e.target.files[0]&&(g(!0),v(e.target.files[0]).then((function(e){g(!1);var n=e.data;0==n.error?a(M({path:n.file,images:JSON.parse(n.images),user_id:t.id})):b(Object(o.a)({},h,{show:!0,title:"File Upload Error",text:"File wasn't loaded. "+n.error}))})).catch((function(e){g(!1),b(Object(o.a)({},h,{show:!0,title:"File Upload Error",text:"File wasn't loaded. Somthing went wrong..."}))})))},size:"sm"}),i.a.createElement("label",{className:"custom-file-label",size:"sm",htmlFor:"inputGroupFile01"},"Choose file"),i.a.createElement("button",{type:"submit",style:{display:"none"}},"Upload")))),i.a.createElement(de.a,{show:h.show,onHide:function(){b(Object(o.a)({},h,{show:!1}))}},i.a.createElement(de.a.Header,{closeButton:!0},i.a.createElement(de.a.Title,null,h.title)),i.a.createElement(de.a.Body,null,h.text),i.a.createElement(de.a.Footer,null,i.a.createElement(ce.a,{variant:"primary",onClick:function(){b(Object(o.a)({},h,{show:!1}))}},"Ok"))))})),ve=Object(s.b)((function(e){return{pdfs:e.pdfs,active_pdf_index:e.active_pdf_index,users:e.users,current_user:e.current_user}}))((function(e){var t=e.pdfs,a=e.active_pdf_index,n=e.users,r=e.current_user,s=e.dispatch,l={signIn:!0,signUp:!1,title:"Login or Register to Upload File",button:{title:"Upload Pdf File",icon:re.h},buttons:[{title:"Cancel"},{title:"Ok",func:function(e){s(G(e))}}]};return i.a.createElement(ne.a,{className:"list-group-flush"},i.a.createElement(ne.a.Item,{className:"topItem"},null==r.id?i.a.createElement(pe,l):i.a.createElement(be,null)),i.a.createElement("div",{className:"scrollBlock"},t.map((function(e,t){var s=n.filter((function(t){return t.id==e.user_id})),l=s.length>0?s[0]:null,c=Object(o.a)({},e,{is_active:t===a,index:t,user:l,current_user:r});return i.a.createElement(_e,Object.assign({key:t},{pdf:c}))})),0==t.length?i.a.createElement(ne.a.Item,null,"Don't have any Pdf Files"):i.a.createElement(i.a.Fragment,null)))})),Ee=function(e){var t=e.page,a=e.dispatch,n={signIn:!1,signUp:!1,sureRemove:!0,title:"Remove Page",button:{title:"Remove",icon:re.i},buttons:[{title:"Cancel"},{title:"Remove it!",func:function(){a(z(t.pdf_id)),a(U(t.id))}}]};return i.a.createElement(ne.a.Item,null,i.a.createElement("div",{className:"itemTitle"},i.a.createElement(c.b,{to:"/pages/"+t.id},i.a.createElement("span",null,t.name))),i.a.createElement("div",{className:"absBtns"},i.a.createElement("div",null,i.a.createElement(c.b,{to:"/pages/"+t.id,className:"btn btn-primary btn-sm"},i.a.createElement(ie.a,{icon:re.e})," Edit")),t.user&&t.user.id==t.current_user.id?i.a.createElement(ge.a,{className:"mr-2"},i.a.createElement(pe,n)):i.a.createElement(i.a.Fragment,null)),i.a.createElement("div",{className:"calendarBlock"},i.a.createElement("div",{className:"calendarIcon"},i.a.createElement(ie.a,{icon:re.a})),i.a.createElement("div",{className:"calendarValue"},t.user?i.a.createElement("div",null,i.a.createElement("small",null,"Added by ",t.user.id==t.current_user.id?"you":t.user.name," ",t.load_date),i.a.createElement("div",null,i.a.createElement("small",null,"Last edit - ",t.last_edit_date))):i.a.createElement(i.a.Fragment,null))))},xe=Ee=Object(s.b)()(Ee),je=Object(s.b)((function(e){return{pages:e.pages,pdfs:e.pdfs,active_pdf_index:e.active_pdf_index,users:e.users,current_user:e.current_user}}))((function(e){var t=e.pages,a=e.pdfs,n=e.active_pdf_index,r=e.users,s=e.current_user,l=e.dispatch,c=a.length>0?a[n].id:null,d=t.filter((function(e){return c==e.pdf_id})),u={signIn:!1,signUp:!1,addPage:!0,title:"Add New Page",button:{title:"Add New Page",icon:re.h,large:!0},buttons:[{title:"Cancel"},{title:"Add Page",func:function(e){var t;l(z(c)),l((t={name:e.name,pdf_id:c,user_id:s.id},{type:O,name:t.name,pdf_id:t.pdf_id,user_id:t.user_id}))}}]},m={signIn:!0,signUp:!0,addPage:!0,title:"Add New Page",button:{title:"Add New Page",icon:re.h,large:!0},buttons:[{title:"Cancel"},{title:"Ok",func:function(e){var t;l(z(c)),l((t={name:e.name,pdf_id:c,login:e.login,pass:e.pass},{type:N,name:t.name,pdf_id:t.pdf_id,login:t.login,pass:g.a.hex_md5(t.pass)}))}}]};return i.a.createElement(i.a.Fragment,null,a.length>0?i.a.createElement(ne.a,{className:"list-group-flush"},i.a.createElement(ne.a.Item,{className:"topItem"},null!==s.id?i.a.createElement(pe,u):i.a.createElement(pe,m)),i.a.createElement("div",{className:"scrollBlock"},d.map((function(e,t){var a=r.filter((function(t){return t.id==e.user_id})),n=a.length>0?a[0]:null,l=Object(o.a)({},e,{user:n,current_user:s});return i.a.createElement(xe,Object.assign({key:t},{page:l}))})),0==d.length?i.a.createElement(ne.a.Item,null,"Don't have any Pages"):i.a.createElement(i.a.Fragment,null))):i.a.createElement(i.a.Fragment,null))})),Oe=Object(s.b)((function(e){return{pdfs:e.pdfs,active_pdf_index:e.active_pdf_index}}))((function(e){e.pdfs,e.active_pdf_index;return i.a.createElement(i.a.Fragment,null,i.a.createElement(ae.a,null,i.a.createElement(te.a,null,i.a.createElement("div",{className:"blockBorder"},i.a.createElement(ve,null)))),i.a.createElement(ae.a,null,i.a.createElement(te.a,null,i.a.createElement("div",{className:"blockBorder"},i.a.createElement(je,null)))))})),ye=(a(102),function(e){var t=e.images,a=e.activeIndex,r=e.items,s=e.onPageChange,l=(e.pageId,Object(n.useState)(0)),c=Object(le.a)(l,2),d=c[0],o=c[1],u=Object(n.useState)(0),m=Object(le.a)(u,2),p=m[0],g=m[1],f=Object(n.useState)(t),_=Object(le.a)(f,2),h=_[0],b=_[1],v=function(e,a){e.preventDefault();var n=parseInt(t.length/r),i="next"==a?d<n?d+1:0:0==d?n:d-1;if(o(i),!(p>=r*i&&p<r*i+r)){var l=r*i;g(l),window.location.hash="#page_"+l,"function"==typeof s&&s({selected:l})}b(t.filter((function(e,t){return t>=r*i&&t<r*i+r})))};return Object(n.useEffect)((function(){var e=d,n=window.location.hash;if(-1!==n.indexOf("#page_")){var i=parseInt(n.replace("#page_",""));!isNaN(i)&&i>0&&i<t.length&&(a=i)}console.log(a,"activeIndex"),a>0&&(g(a),"function"==typeof s&&s({selected:a}),a>r*d+r&&(e=parseInt(a/r),o(e))),b(t.filter((function(t,a){return a>=r*e&&a<r*e+r}))),console.log("--pag->>>")}),[t]),i.a.createElement("div",{className:"imagePreviewsContainer"},i.a.createElement("div",{className:"imagePreviewsPrev",onClick:function(e){v(e,"prev")}},i.a.createElement(ie.a,{icon:re.d})),i.a.createElement("div",{className:"imagePreviews"},i.a.createElement(i.a.Fragment,null,console.log(h,"--\x3e>render inages")),h.map((function(e,t){var a=e.replace(".png","_preview.png").replace(".jpg","_preview.jpg");return i.a.createElement("div",{onClick:function(e){e.preventDefault();var a=r*d+t;g(a),window.location.hash="#page_"+a,"function"==typeof s&&s({selected:a})},className:p==r*d+t?"active imagePreview":"imagePreview"},i.a.createElement("img",{src:a}),i.a.createElement("span",{className:"imagePreviewNumber"},i.a.createElement("span",null,r*d+t+1)))}))),i.a.createElement("div",{onClick:function(e){v(e,"next")},className:"imagePreviewsNext"},i.a.createElement(ie.a,{icon:re.c})))}),we=function(e){var t=e.page,a=e.newTextId,r=e.dispatch;console.log(t,"page");var s={visibility:"hidden",left:0,top:0,value:"",width:0,height:0,imageTextId:null},l={remove:"visible",move:"visible",warning:"visible",ok:"visible",message:"visible"},c={warning:!1,ok:!1,message:!0},u=Object(n.useRef)(null),m=Object(n.useState)([]),p=Object(le.a)(m,2),g=p[0],f=p[1],_=Object(n.useState)([]),j=Object(le.a)(_,2),O=j[0],y=j[1],w=Object(n.useState)(""),N=Object(le.a)(w,2),k=N[0],F=N[1],I=Object(n.useState)(0),T=Object(le.a)(I,2),P=T[0],S=T[1],A=Object(n.useState)(Object(o.a)({},s)),C=Object(le.a)(A,2),D=C[0],R=C[1],B=Object(n.useState)(Object(o.a)({},l)),G=Object(le.a)(B,2),M=G[0],V=G[1],J=Object(n.useState)(Object(o.a)({},c)),W=Object(le.a)(J,2),Y=W[0],X=W[1],q=Object(n.useState)(!1),Z=Object(le.a)(q,2),$=(Z[0],Z[1]),ae={signIn:!1,signUp:!1,sureRemove:!0,title:"Remove Page",button:{title:"Remove",icon:re.i},buttons:[{title:"Cancel"},{title:"Remove it!",func:function(){r(U(t.id))}}]},ne=function(e,a){var n;r((n=a.id,{type:v,id:n})),r(H(t.id)),r(z(t.pdf_id)),de().then((function(e){f(Object(d.a)(oe(g,{id:D.imageTextId,visibility:"hidden"})));var a=t.texts.filter((function(e){return e.id==D.imageTextId}))[0].messages;y(Object(d.a)(a))}))},se=function(e){if(k.trim().length>0){e.preventDefault();var n=D.imageTextId;null==D.imageTextId?(r((i={text:"",max_width:0,x:D.left,y:D.top,page_id:t.id,image_index:P,id:a,user_id:t.current_user.id,msgText:k,date:Q()},{type:x,user_id:i.user_id,msgText:i.msgText,date:i.date,text:i.text,max_width:i.max_width,x:i.x,y:i.y,page_id:i.page_id,image_index:i.image_index,id:i.id})),r(H(t.id)),r(z(t.pdf_id)),R(Object(o.a)({},D,{imageTextId:a})),n=a,console.log(a,"newTextId")):(r(function(e){return{type:E,user_id:e.user_id,text_id:e.text_id,text:e.text,date:e.date}}({text:k,date:Q(),text_id:D.imageTextId,user_id:t.current_user.id})),r(H(t.id)),r(z(t.pdf_id))),de().then((function(e){f(Object(d.a)(oe(me(),{id:n,visibility:"hidden"})));var a=t.texts.filter((function(e){return e.id==n}));a.length>0&&y(Object(d.a)(a[0].messages)),F("")}))}var i},de=function(){var e=u.current.getContext("2d"),a=new Image;return a.src=t.pdf.images[P],new Promise((function(t){a.onload=function(){var n=1e3*a.height/a.width;e.canvas.width=1e3,e.canvas.height=n,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(a,0,0,1e3,n),f(me()),t({status:"ok"})}}))},oe=function(e,t){return e.map((function(e){var a="visible";return void 0!==t&&e.id==t.id&&(a=t.visibility),e.visibility=a,e}))},me=function(){var e=t.texts.filter((function(e){return e.image_index==P}));return e.forEach((function(e){e.messages=t.messages.filter((function(t){return t.text_id==e.id}))})),oe(e)};return Object(n.useEffect)((function(){de(P),console.log("---ed---\x3e>>")}),[P]),i.a.createElement(ee.a,{onClick:function(e){K(e.target,"imageTexts")||($(!1),R(Object(o.a)({},s)),f(Object(d.a)(oe(g))))}},i.a.createElement(te.a,null,i.a.createElement("div",null,i.a.createElement("h2",null,t.name," "),t.user&&t.user.id==t.current_user.id?i.a.createElement(ge.a,{className:"mr-2"},i.a.createElement(pe,ae)):i.a.createElement(i.a.Fragment,null)),i.a.createElement("div",{className:"calendarBlock"},i.a.createElement("div",{className:"calendarIcon"},i.a.createElement(ie.a,{icon:re.a})),i.a.createElement("div",{className:"calendarValue"},t.user?i.a.createElement("div",null,i.a.createElement("small",null,"Added by ",t.user.id==t.current_user.id?"you":t.user.name," ",t.load_date),i.a.createElement("div",null,i.a.createElement("small",null,"Last edit - ",t.last_edit_date))):i.a.createElement(i.a.Fragment,null))),i.a.createElement(ye,{images:t.pdf.images,items:5,onPageChange:function(e){S(e.selected)},activeIndex:0,pageId:t.id})),i.a.createElement(te.a,null,i.a.createElement("div",{className:"imageParent"},i.a.createElement("canvas",{ref:u}),i.a.createElement("div",{className:"imageTexts",onClick:function(e){if(!K(e.target,"imageText")&&!K(e.target,"imageTextFileldParent")){V(Object(o.a)({},l,{remove:"hidden",ok:"hidden",warning:"hidden"})),X(Object(o.a)({},c));var t=e.target.getBoundingClientRect();R(Object(o.a)({},s,{visibility:"visible",width:120,height:30,left:e.clientX-t.x,top:e.clientY-t.y})),y([]),f(Object(d.a)(oe(g)))}}},g.map((function(e,a){return i.a.createElement("div",{key:a,style:{position:"absolute",zIndex:3,left:e.x,top:e.y,maxWidth:e.max_width,visibility:e.visibility,borderWidth:t.user&&t.user.id==t.current_user.id||""!=e.text?1:0},className:e.status?"imageText "+e.status+"Text":"imageText",onClick:function(t){!function(e,t,a,n,i){e.preventDefault(),e.stopPropagation(),$(!1),V(Object(o.a)({},l)),X(Object(o.a)({},c,{warning:"warning"==a,ok:"ok"==a}));var r=e.currentTarget.getBoundingClientRect();R({visibility:"visible",left:e.currentTarget.offsetLeft,top:e.currentTarget.offsetTop,value:i,width:r.width+30,height:r.height>30?r.height:30,imageTextId:t}),y(Object(d.a)(n)),f(Object(d.a)(oe(g,{id:t,visibility:"hidden"})))}(t,e.id,e.status,e.messages,e.text)}},i.a.createElement("span",null,e.text),e.messages.length>0?i.a.createElement(ce.a,{variant:"primary",size:"sm"},i.a.createElement(ie.a,{icon:re.f}),e.messages.length):i.a.createElement(i.a.Fragment,null))})),i.a.createElement("div",{className:"imageTextFileldParent",style:{left:D.left,top:D.top,visibility:D.visibility}},i.a.createElement("textarea",{disabled:!(t.user&&t.user.id==t.current_user.id),placeholder:"Your text...",onChange:function(e){if(R(Object(o.a)({},D,{value:e.target.value})),e.target.value.trim().length>0)if(null==D.imageTextId){r((n={text:e.target.value,max_width:e.target.offsetWidth,x:D.left,y:D.top,page_id:t.id,image_index:P,id:a},{type:b,text:n.text,max_width:n.max_width,x:n.x,y:n.y,page_id:n.page_id,image_index:n.image_index,id:n.id})),r(H(t.id)),r(z(t.pdf_id)),V(Object(o.a)({},l,{remove:"visible"})),R(Object(o.a)({},D,{imageTextId:a,value:e.target.value}));e.target.value;de().then((function(e){f(Object(d.a)(oe(me(),{id:D.imageTextId,visibility:"hidden"})))}))}else r(L({text:e.target.value,id:D.imageTextId,max_width:e.target.offsetWidth,x:D.left,y:D.top})),r(H(t.id)),r(z(t.pdf_id)),f(Object(d.a)(oe(me(),{id:D.imageTextId,visibility:"hidden"})));var n},style:{width:""!=D.value||t.user&&t.user.id==t.current_user.id?D.width:0,borderWidth:t.user&&t.user.id==t.current_user.id?1:0,height:D.height,resize:t.user&&t.user.id==t.current_user.id?"both":"none"},value:D.value,className:Y.warning?"form-control form-control-warning imageTextFileld":Y.ok?"form-control form-control-ok imageTextFileld":"form-control imageTextFileld",rows:"1"}),i.a.createElement("div",{className:"imageTextFileldButtons"},t.user&&t.user.id==t.current_user.id?i.a.createElement(ce.a,{style:{display:"visible"==M.remove?"inline":"none"},onClick:function(e){var a;r((a=D.imageTextId,{type:h,id:a})),r(H(t.id)),r(z(t.pdf_id)),R(Object(o.a)({},s)),de()},variant:"outline-primary",size:"sm"},i.a.createElement(ie.a,{icon:re.i})):i.a.createElement(i.a.Fragment,null),i.a.createElement(ce.a,{style:{display:"visible"==M.warning?"inline":"none"},onClick:function(e){e.preventDefault(),e.stopPropagation(),r(L({text:D.value,id:D.imageTextId,max_width:D.max_width,x:D.left,y:D.top,status:Y.warning?null:"warning"})),r(H(t.id)),r(z(t.pdf_id)),X(Object(o.a)({},c,{warning:!Y.warning,ok:!!Y.warning&&Y.ok})),de().then((function(e){f(Object(d.a)(oe(g,{id:D.imageTextId,visibility:"hidden"})))}))},variant:Y.warning?"danger":"outline-danger",size:"sm"},i.a.createElement(ie.a,{icon:re.g})),i.a.createElement(ce.a,{style:{display:"visible"==M.ok?"inline":"none"},onClick:function(e){e.preventDefault(),e.stopPropagation(),r(L({text:D.value,id:D.imageTextId,max_width:D.max_width,x:D.left,y:D.top,status:Y.ok?null:"ok"})),r(H(t.id)),r(z(t.pdf_id)),X(Object(o.a)({},c,{warning:!!Y.ok&&Y.warning,ok:!Y.ok})),de().then((function(e){f(Object(d.a)(oe(g,{id:D.imageTextId,visibility:"hidden"})))}))},variant:Y.ok?"success":"outline-success",size:"sm"},i.a.createElement(ie.a,{icon:re.b})),i.a.createElement(ce.a,{style:{display:"visible"==M.message?"inline":"none"},onClick:function(){X(Object(o.a)({},Y,{message:!Y.message}))},variant:Y.message?"primary":"outline-primary",size:"sm"},i.a.createElement(ie.a,{icon:re.f}))),i.a.createElement("div",{className:"imageTextFileldMessageParent",style:{display:Y.message?"block":"none"}},i.a.createElement(ue.a,{variant:"primary"},O.map((function(e,a){var n=t.users.filter((function(t){return t.id==e.user_id})),r=n.length>0?n[0]:null;return i.a.createElement("div",{key:a},i.a.createElement("div",null,r?i.a.createElement(i.a.Fragment,null,r.id==t.current_user.id?"you":r.name,", "):i.a.createElement(i.a.Fragment,null,"unsigned user, ")," ",e.date),i.a.createElement("div",null,e.text),r&&r.id==t.current_user.id&&i.a.createElement(ce.a,{onClick:function(t){ne(0,e)},variant:"outline-primary",size:"sm"},i.a.createElement(ie.a,{icon:re.i})),i.a.createElement("hr",null))})),i.a.createElement("div",null,i.a.createElement("textarea",{onChange:function(e){F(e.target.value)},placeholder:"Your message...",className:"form-control imageTextFileldMessageField",rows:"4",value:k}),i.a.createElement(ge.a,{className:"imageTextFileldMessageBtn"}," ",i.a.createElement(ce.a,{className:"simpBtn",onClick:function(e){se(e)},variant:"primary",size:"sm"},"Add Message")," ")))))))))},Ne=we=Object(s.b)()(we),ke=Object(s.b)((function(e){return{pages:e.pages,pdfs:e.pdfs,texts:e.texts,messages:e.messages,users:e.users,current_user:e.current_user}}))((function(e){var t=e.pages,a=e.pdfs,n=e.texts,r=e.messages,s=e.users,l=e.current_user,d=(e.history,Object($.e)().id),o=t.filter((function(e){return e.id==d})),u=o.length>0?o[0]:null,m=n.length>0?n[n.length-1].id+1:0;if(null!==u){var p=a.filter((function(e){return e.id==u.pdf_id})),g=p.length>0?p[0]:null;u.pdf=g;var f=n.filter((function(e){return e.page_id==d}));u.texts=f,u.texts&&(u.messages=r),u.users=s,u.current_user=l;var _=s.filter((function(e){return e.id==u.user_id})),h=_.length>0?_[0]:null;u.user=h}return i.a.createElement(i.a.Fragment,null,i.a.createElement(c.b,{to:"/"},"Go Back"),null===u?i.a.createElement(i.a.Fragment,null,"Page Not Found"):i.a.createElement(Ne,{page:u,newTextId:m}))})),Fe=Object($.f)(ke),Ie=Object(s.b)((function(e){return{current_user:e.current_user,users:e.users}}))((function(e){var t=e.current_user,a=e.users,n=e.dispatch,r={signIn:!0,signUp:!1,title:"Login or Register",button:{title:"Login or Register"},buttons:[{title:"Cancel"},{title:"Ok",func:function(e){n(G(e))}}]},s=null;if(null!==t.id){var l=a.filter((function(e){return e.id==t.id}));s=l.length>0?l[0]:null}return i.a.createElement(ne.a,{className:"topUserBlock"},null==t.id?i.a.createElement(ne.a.Item,null,i.a.createElement(pe,r)):i.a.createElement(ne.a.Item,null,"Hello, ",i.a.createElement("strong",null,s?s.name:"")," ",i.a.createElement("div",null,i.a.createElement(ce.a,{onClick:function(){n({type:w})},variant:"primary",size:"sm"},"SignOut"))))})),Te=Ie=Object(s.b)()(Ie);a(106);var Pe=Object(s.b)()(Object($.f)((function(e){e.location;var t=e.dispatch;return Object(n.useEffect)((function(){!function(){var e=[["users",V],["pages",J],["texts",W],["pdfs",Y],["messages",X]],a=[];e.forEach((function(e){var t=new FormData;t.append("action","get"),t.append("data",""),t.append("name",e[0]),a.push(Object(u.post)("/db.php",t))})),m.a.all(a).then(m.a.spread((function(){for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];e.forEach((function(e,a){var i=n[a];0==i.data.error&&t(e[1](JSON.parse(i.data.data)))}));var r=localStorage.getItem("current_user_edithomework");null!==r&&t(q(r))}))).catch((function(e){console.log("loading error")}))}()}),[]),i.a.createElement(ee.a,null,i.a.createElement(te.a,{className:"headerBlock"},i.a.createElement("h1",{className:"mainLogo"},i.a.createElement("span",null,"Edit"),"Homework"),i.a.createElement(Te,null)),i.a.createElement(te.a,{className:"contentBlock"},i.a.createElement($.a,{exact:!0,path:"/",component:Oe}),i.a.createElement($.a,{exact:!0,path:"/pages/:id",component:Fe})),i.a.createElement(te.a,{className:"bottomBlock"}))}))),Se=Object(l.b)((function(){var e,t,a,n,i,r,s,l,c,m,p,g,B,L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,U=arguments.length>1?arguments[1]:void 0,G=function(e,t){var a=JSON.stringify(t),n=new FormData;n.append("name",e),n.append("action","set"),n.append("data",a),Object(u.post)("/db.php",n).then((function(t){console.log(t,"saved",e)}))};switch(U.type){case f:return Object(o.a)({},L,{active_pdf_index:U.index});case _:return G("texts",e=L.texts.map((function(e){return e.id==U.id&&(e.text=U.text,e.max_width=U.max_width,e.x=U.x,e.y=U.y,e.status=U.status,e.last_edit_date=Q()),e}))),Object(o.a)({},L,{texts:e});case b:return n={text:U.text,x:U.x,y:U.y,page_id:U.page_id,image_index:U.image_index,id:U.id,max_width:U.max_width,status:null,load_date:Q(),last_edit_date:Q()},G("texts",[].concat(Object(d.a)(L.texts),[n])),Object(o.a)({},L,{texts:[].concat(Object(d.a)(L.texts),[n])});case E:return i={id:a=L.messages.length>0?L.messages[L.messages.length-1].id+1:0,user_id:U.user_id,text_id:U.text_id,text:U.text,date:U.date},G("messages",[].concat(Object(d.a)(L.messages),[i])),Object(o.a)({},L,{messages:[].concat(Object(d.a)(L.messages),[i])});case x:return n={text:U.text,x:U.x,y:U.y,page_id:U.page_id,image_index:U.image_index,id:U.id,max_width:U.max_width,status:null},i={id:a=L.messages.length>0?L.messages[L.messages.length-1].id+1:0,user_id:U.user_id,text_id:U.id,text:U.msgText,date:U.date},G("messages",[].concat(Object(d.a)(L.messages),[i])),G("texts",[].concat(Object(d.a)(L.texts),[n])),Object(o.a)({},L,{texts:[].concat(Object(d.a)(L.texts),[n]),messages:[].concat(Object(d.a)(L.messages),[i])});case O:return a=L.pages.length>0?L.pages[L.pages.length-1].id+1:0,s={name:U.name,id:a,pdf_id:U.pdf_id,user_id:U.user_id,load_date:Q(),last_edit_date:Q()},G("pages",[].concat(Object(d.a)(L.pages),[s])),Object(o.a)({},L,{pages:[].concat(Object(d.a)(L.pages),[s])});case h:return e=L.texts.filter((function(e){return e.id!==U.id})),t=L.messages.filter((function(e){return e.text_id!==U.id})),G("texts",e),G("messages",t),Object(o.a)({},L,{texts:e,messages:t});case v:return G("messages",t=L.messages.filter((function(e){return e.id!==U.id}))),Object(o.a)({},L,{messages:t});case j:r=L.pages.filter((function(e){return e.id!==U.id})),e=L.texts.filter((function(e){return e.page_id!==U.id}));var M=L.texts.filter((function(e){return e.page_id==U.id}));return B=M.map((function(e){return e.id})),G("messages",t=L.messages.filter((function(e){return-1==B.indexOf(e.text_id)}))),G("texts",e),G("pages",r),Object(o.a)({},L,{pages:r,texts:e,messages:t});case y:return l=null,c=Object(d.a)(L.users),(m=L.users.filter((function(e){return e.name==U.name&&e.pass==U.pass}))).length>0?l=m[0].id:(a=L.users.length>0?L.users[L.users.length-1].id+1:0,c=[].concat(Object(d.a)(L.users),[{id:a,name:U.name,pass:U.pass}]),l=a),G("users",Object(d.a)(c)),localStorage.setItem("current_user_edithomework",l),Object(o.a)({},L,{current_user:{id:l},users:Object(d.a)(c)});case w:return localStorage.removeItem("current_user_edithomework"),Object(o.a)({},L,{current_user:{id:null}});case N:return l=null,c=Object(d.a)(L.users),(m=L.users.filter((function(e){return e.name==U.login&&e.pass==U.pass}))).length>0?l=m[0].id:(a=L.users.length>0?L.users[L.users.length-1].id+1:0,c=[].concat(Object(d.a)(L.users),[{id:a,name:U.login,pass:U.pass}]),l=a),p=L.pages.length>0?L.pages[L.pages.length-1].id+1:0,s={name:U.name,id:p,pdf_id:U.pdf_id,user_id:l,load_date:Q(),last_edit_date:Q()},G("pages",[].concat(Object(d.a)(L.pages),[s])),G("users",Object(d.a)(c)),localStorage.setItem("current_user_edithomework",l),Object(o.a)({},L,{pages:[].concat(Object(d.a)(L.pages),[s]),current_user:{id:l},users:Object(d.a)(c)});case k:var z={id:a=L.pdfs.length>0?L.pdfs[L.pdfs.length-1].id+1:0,path:U.path,images:U.images,user_id:U.user_id,load_date:Q(),last_edit_date:Q()};return G("pdfs",[].concat(Object(d.a)(L.pdfs),[z])),Object(o.a)({},L,{pdfs:[].concat(Object(d.a)(L.pdfs),[z])});case F:g=L.pdfs.filter((function(e){return e.id!==U.id}));var H=L.pdfs.filter((function(e){return e.id==U.id})),V=H.length>0?H[0]:null;r=L.pages.filter((function(e){return e.pdf_id!==U.id}));var J=L.pages.filter((function(e){return e.pdf_id==U.id})).map((function(e){return e.id}));e=L.texts.filter((function(e){return-1==J.indexOf(e.page_id)}));var W=L.texts.filter((function(e){return-1!==J.indexOf(e.page_id)}));return B=W.map((function(e){return e.id})),G("messages",t=L.messages.filter((function(e){return-1==B.indexOf(e.text_id)}))),G("texts",e),G("pages",r),G("pdfs",g),V&&function(e,t){var a=new FormData;a.append("images",JSON.stringify(e)),a.append("pdf",t),Object(u.post)("/remove_pdf.php",a).then((function(e){console.log(e,"removed")}))}(V.images,V.path),Object(o.a)({},L,{pdfs:Object(d.a)(g),pages:Object(d.a)(r),texts:Object(d.a)(e),messages:Object(d.a)(t)});case I:return g=L.pdfs.map((function(e){return e.id==U.id&&(e.last_edit_date=Q()),e})),G("pdfs",Object(d.a)(g)),Object(o.a)({},L,{pdfs:Object(d.a)(g)});case T:return console.log(U.id,"page action"),r=L.pages.map((function(e){return e.id==U.id&&(e.last_edit_date=Q()),e})),G("pages",Object(d.a)(r)),Object(o.a)({},L,{pages:Object(d.a)(r)});case P:return Object(o.a)({},L,{users:Object(d.a)(U.data)});case S:return Object(o.a)({},L,{pages:Object(d.a)(U.data)});case A:return Object(o.a)({},L,{pdfs:Object(d.a)(U.data)});case C:return Object(o.a)({},L,{texts:Object(d.a)(U.data)});case D:return Object(o.a)({},L,{messages:Object(d.a)(U.data)});case R:var Y=L.users.filter((function(e){return e.id==U.id})).length>0?{id:U.id}:Object(o.a)({},L.current_user);return Object(o.a)({},L,{current_user:Y});default:return L}}));Object(r.render)(i.a.createElement(s.a,{store:Se},i.a.createElement(c.a,null,i.a.createElement(Pe,null))),document.getElementById("root"))},72:function(e,t,a){e.exports=a(107)}},[[72,1,2]]]);
//# sourceMappingURL=main.6a08d9c9.chunk.js.map